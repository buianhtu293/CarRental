@model CarRental.MVC.Models.Feedback.FeedbackReportIndexViewModel
@using System.Globalization
@using System.Web

@* 
   Partial: renders feedback in a card/list layout that matches the UC25 mock.
   Returned by FeedbackController.Table(...) and included by Index.cshtml.
*@
<section aria-labelledby="feedback-list-heading">
    <header class="d-flex justify-content-between align-items-center mb-2">
        <h2 id="feedback-list-heading" class="h6 mb-0">Feedback</h2>
        <div class="text-muted small">Showing @Model.Items.Count item(s) on this page</div>
    </header>

    @if (!Model.Items.Any())
    {
        <div class="text-center text-muted py-5 border rounded bg-light">No feedback found.</div>
    }
    else
    {
        <ol class="list-unstyled mb-0">
            @foreach (var fb in Model.Items)
            {
                <li class="border-top py-3">
                    <article class="feedback-row">
                        <!-- Top meta: user + stars + date -->
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div class="d-flex align-items-center gap-2">
                                <span class="fa-regular fa-user text-secondary" aria-hidden="true"></span>
                                <span
                                    class="small text-muted">@(!string.IsNullOrWhiteSpace(fb.UserName) ? fb.UserName : "User")</span>
                            </div>

                            <div class="d-flex align-items-center gap-3">
                                <div class="star-list" aria-label="Rating: @(fb.Stars ?? 0) out of 5">
                                    @{
                                        var stars = fb.Stars ?? 0;
                                        for (int i = 1; i <= 5; i++)
                                        {
                                            if (i <= stars)
                                            {
                                                @:<i class="fa-solid fa-star text-warning" title="@i"></i>
                                            }
                                            else
                                            {
                                                @:<i class="fa-regular fa-star text-secondary" title="@i"></i>
                                            }
                                        }
                                    }
                                </div>
                                <time class="small text-muted text-nowrap" datetime="@(fb.FeedbackDate?.ToString("O"))">
                                    @(fb.FeedbackDate?.ToString("dd/MM/yyyy HH:mm"))
                                </time>
                            </div>
                        </div>

                        <!-- Body: placeholder image + car title + From/To -->
                        <div class="row g-3">
                            <figure class="col-12 col-md-3">
                                @if (fb.CarImageUrls == null || !fb.CarImageUrls.Any())
                                {
                                    <div class="placeholder-img border bg-light w-100" role="img"
                                         aria-label="Car photo placeholder"></div>
                                }
                                else
                                {
                                    <div id="carousel-@fb.FeedbackId" class="carousel slide" data-bs-ride="carousel">
                                        <div class="carousel-inner">
                                            @for (var i = 0; i < fb.CarImageUrls.Count; i++)
                                            {
                                                <div class="carousel-item @(i == 0 ? "active" : "")"
                                                     style="aspect-ratio: 4/3">
                                                    <img src="@fb.CarImageUrls[i]"
                                                         class="d-block w-100 h-100 object-fit-cover"
                                                         alt="Car photo @(i + 1)">
                                                </div>
                                            }
                                        </div>
                                        @if (fb.CarImageUrls.Count > 1)
                                        {
                                            <button class="carousel-control-prev" type="button"
                                                    data-bs-target="#carousel-@fb.FeedbackId" data-bs-slide="prev">
                                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                                <span class="visually-hidden">Previous</span>
                                            </button>
                                            <button class="carousel-control-next" type="button"
                                                    data-bs-target="#carousel-@fb.FeedbackId" data-bs-slide="next">
                                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                                <span class="visually-hidden">Next</span>
                                            </button>
                                            <div class="carousel-indicators">
                                                @for (var i = 0; i < fb.CarImageUrls.Count; i++)
                                                {
                                                    <button type="button" data-bs-target="#carousel-@fb.FeedbackId"
                                                            data-bs-slide-to="@i" class="@(i == 0 ? "active" : "")"
                                                            aria-current="@(i == 0 ? "true" : "false")"
                                                            aria-label="Slide @(i + 1)"></button>
                                                }
                                            </div>
                                        }
                                    </div>
                                }
                            </figure>
                            <div class="col-12 col-md-9">
                                <h3 class="h6 mb-2 fw-semibold">@fb.CarLabel</h3>

                                <ul class="list-unstyled small mb-2">
                                    <li class="d-flex">
                                        <span class="me-2">•</span>
                                        <span>
                                            <strong>From:</strong>
                                            @((fb.PickupDate ?? fb.FeedbackDate)?.ToString("dd/MM/yyyy - hh:mm tt", CultureInfo.InvariantCulture))
                                        </span>
                                    </li>
                                    <li class="d-flex">
                                        <span class="me-2">•</span>
                                        <span>
                                            <strong>To:</strong>
                                            @((fb.ReturnDate ?? fb.FeedbackDate)?.ToString("dd/MM/yyyy - hh:mm tt", CultureInfo.InvariantCulture))
                                        </span>
                                    </li>
                                </ul>

                                @if (!string.IsNullOrWhiteSpace(fb.Comment))
                                {
                                    <p class="small text-muted mb-1">
                                        @Html.Raw(HttpUtility.HtmlEncode(fb.Comment))
                                    </p>
                                }

                                <p class="small mb-0">
                                    <a asp-controller="CarOwnerBooking"
                                       asp-action="Index"
                                       asp-route-page="1"
                                       asp-route-searchTerm="@fb.BookingNo"
                                       class="link-secondary text-decoration-none">
                                        View booking @fb.BookingNo
                                    </a>
                                </p>
                                
                                <p class="small mb-0">
                                    <a asp-controller="CarOwnerBooking"
                                       asp-action="Details"
                                       asp-route-bookingItemId="@fb.BookingItemId"
                                       class="link-secondary text-decoration-none">
                                        View detail
                                    </a>
                                </p>
                            </div>
                        </div>
                    </article>
                </li>
            }
        </ol>
    }

    <footer class="mt-3 d-flex justify-content-center">
        @await Html.PartialAsync("_Paging", Model.Paging)
    </footer>
</section>

@section Styles {
    <style>
        /* Match the mock's gray rectangle for the left image block */
        .placeholder-img {
            aspect-ratio: 4 / 3;
            background-image: linear-gradient(45deg, transparent calc(50% - 1px), #bbb, transparent calc(50% + 1px)),
            linear-gradient(-45deg, transparent calc(50% - 1px), #bbb, transparent calc(50% + 1px));
            background-size: 100% 100%, 100% 100%;
            background-repeat: no-repeat;
        }

        .star-list i {
            line-height: 1;
        }

        .feedback-row { /* keeps the structure readable for screen readers */
        }
    </style>
}
